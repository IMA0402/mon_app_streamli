import streamlit as st
import pandas as pd
import numpy as np
import seaborn as sns
import matplotlib.pyplot as plt
from sklearn.ensemble import RandomForestClassifier
from sklearn.model_selection import train_test_split
from sklearn.preprocessing import LabelEncoder
from sklearn.metrics import accuracy_score

# ๐ ุฅุนุฏุงุฏ ุงูุฎุท ูุฏุนู ุงูุนุฑุจูุฉ
plt.rcParams['font.family'] = 'Arial'
plt.rcParams['axes.unicode_minus'] = False

# ๐ ุฅุนุฏุงุฏ ูุงุฌูุฉ ุงูุชุทุจูู
st.title("๐ ุชุทุจูู ุงูุฐูุงุก ุงูุงุตุทูุงุนู ูุชุญููู ุงูุญููุงุช ุงูุชุณููููุฉ")
st.write("๐ ุฃุฏุฎู ุจูุงูุงุช ุญููุชู ุงูุชุณููููุฉ ููุญุตูู ุนูู ุชูุตูุงุช ุชุนุชูุฏ ุนูู ุงูุฐูุงุก ุงูุงุตุทูุงุนู.")

# ๐ ุฅุฏุฎุงู ุจูุงูุงุช ุงูุญููุฉ
budget = st.number_input("๐ฐ ููุฒุงููุฉ ุงูุญููุฉ (ุงูุฏุฑูู ุงููุบุฑุจู):", min_value=1000, max_value=100000, step=500)
channel = st.selectbox("๐ก ุงูููุงุฉ ุงูุชุณููููุฉ:", ["ุฅุนูุงูุงุช ุฑูููุฉ", "ูุณุงุฆู ุงูุชูุงุตู", "ุชููุฒููู", "ุฑุงุฏูู", "ุจุฑูุฏ ุฅููุชุฑููู"])
audience = st.selectbox("๐ฅ ุงููุฆุฉ ุงููุณุชูุฏูุฉ:", ["18-24", "25-34", "35-44", "45-54", "55+"])
duration = st.slider("โณ ูุฏุฉ ุงูุญููุฉ (ุจุงูุฃูุงู):", min_value=7, max_value=90, step=7)
market_condition = st.selectbox("๐ ุญุงูุฉ ุงูุณูู:", ["ุทุจูุนูุฉ", "ุฃุฒูุฉ ููุฑููุง", "ุฃุฒูุฉ ุงูุชุตุงุฏูุฉ"])

# ๐ ูุนุงูุฌุฉ ุงูุจูุงูุงุช
df = pd.DataFrame({
    "budget": np.random.randint(1000, 50000, 100),
    "channel": np.random.choice(["ุฅุนูุงูุงุช ุฑูููุฉ", "ูุณุงุฆู ุงูุชูุงุตู", "ุชููุฒููู", "ุฑุงุฏูู", "ุจุฑูุฏ ุฅููุชุฑููู"], 100),
    "audience": np.random.choice(["18-24", "25-34", "35-44", "45-54", "55+"], 100),
    "duration": np.random.randint(7, 90, 100),
    "market_condition": np.random.choice(["ุทุจูุนูุฉ", "ุฃุฒูุฉ ููุฑููุง", "ุฃุฒูุฉ ุงูุชุตุงุฏูุฉ"], 100),
    "success": np.random.choice([0, 1], 100)
})

# ๐ ุชุฑููุฒ ุงูููู (ุฅูุดุงุก ุชุฑููุฒ ูููุตู ููู ุนููุฏ)
le_channel = LabelEncoder()
df["channel"] = le_channel.fit_transform(df["channel"])

le_audience = LabelEncoder()
df["audience"] = le_audience.fit_transform(df["audience"])

le_market = LabelEncoder()
df["market_condition"] = le_market.fit_transform(df["market_condition"])

# ๐ ุฅุนุฏุงุฏ ุงูุจูุงูุงุช
X = df[["budget", "channel", "audience", "duration", "market_condition"]]
y = df["success"]
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)

# ๐ ุชุฏุฑูุจ ุงููููุฐุฌ
model = RandomForestClassifier(n_estimators=100, random_state=42)
model.fit(X_train, y_train)

# ๐ ุชุญููู ุงูููุฒุงุช
importances = model.feature_importances_
importance_df = pd.DataFrame({"ุงูููุฒุฉ": X.columns, "ุงูุฃูููุฉ": importances}).sort_values(by="ุงูุฃูููุฉ", ascending=False)

# ๐ ุฏูุฉ ุงููููุฐุฌ
accuracy = accuracy_score(y_test, model.predict(X_test))
st.write(f"๐ **ุฏูุฉ ุงููููุฐุฌ: {accuracy * 100:.2f}%**")

# ๐ ุชูุณูุฑ ุงููุชุงุฆุฌ
# ุงูุชุญูู ูู ูุฌูุฏ ุงููุฆุงุช ุงูุฌุฏูุฏุฉ ูุฅุถุงูุชูุง ุฅุฐุง ูุฒู ุงูุฃูุฑ
if channel not in le_channel.classes_:
    le_channel.classes_ = np.append(le_channel.classes_, channel)
if audience not in le_audience.classes_:
    le_audience.classes_ = np.append(le_audience.classes_, audience)
if market_condition not in le_market.classes_:
    le_market.classes_ = np.append(le_market.classes_, market_condition)

# ุงูุชูุจุค
new_data = pd.DataFrame([[budget, le_channel.transform([channel])[0], le_audience.transform([audience])[0], duration, le_market.transform([market_condition])[0]]],
                        columns=["budget", "channel", "audience", "duration", "market_condition"])

prediction = model.predict(new_data)[0]
result = "ูุฌุงุญ ๐ฏ" if prediction == 1 else "ูุดู โ๏ธ"

# ๐ ุชูุฑูุฑ ุชุญูููู ุดุงูู
analysis = f"""
๐ **ุชูุฑูุฑ ุชุญูููู ุดุงูู ุญูู ุงูุญููุฉ ุงูุชุณููููุฉ:**  
- ุจูุงุกู ุนูู ุงูููุฒุงููุฉ ุงููุญุฏุฏุฉ ({budget}$) ูุงุฎุชูุงุฑ ุงูููุงุฉ ุงูุชุณููููุฉ ({channel})ุ ุชู ุชุญููู ุงููุนุทูุงุช ูุงูุชูุจุค ุจูุชูุฌุฉ ุงูุญููุฉ.  
- ุงููุฆุฉ ุงููุณุชูุฏูุฉ ({audience}) ุชูุนุจ ุฏูุฑุงู ูุญูุฑูุงู ูู ูุฌุงุญ ุงูุญููุฉุ ุจุงูุฅุถุงูุฉ ุฅูู ูุฏุฉ ุงูุญููุฉ ุงููุญุฏุฏุฉ ({duration} ุฃูุงู).  
- ุชู ุงูุฃุฎุฐ ูู ุงูุงุนุชุจุงุฑ ุญุงูุฉ ุงูุณูู ุงูุญุงููุฉ ({market_condition}) ูุงูุชู ูุฏ ุชุคุซุฑ ุจุดูู ููุญูุธ ุนูู ุงูุฃุฏุงุก.  
- **ูุชูุฌุฉ ุงูุชูุจุค:** ุงูุญููุฉ ูู ุงููุญุชูู ุฃู ุชููู ุจูุณุจุฉ ุนุงููุฉ **{result}**.  
- **ุชุญููู ุงูููุฒุงุช ุงููุคุซุฑุฉ:**  
"""

for index, row in importance_df.iterrows():
    analysis += f"- **{row['ุงูููุฒุฉ']}**: ูุณุชูู ุชุฃุซูุฑู ุนูู ุงููุฌุงุญ ูู **{row['ุงูุฃูููุฉ']:.2f}**.\n"

st.write(analysis)

# ๐ ุฑุณู ุงููุฎุทุทุงุช
st.subheader("๐ ุฃูููุฉ ุงูููุฒุงุช ูู ุงุชุฎุงุฐ ุงููุฑุงุฑ")
fig, ax = plt.subplots()
sns.barplot(x="ุงูุฃูููุฉ", y="ุงูููุฒุฉ", data=importance_df, palette="viridis", ax=ax)
ax.set_title("ูุฎุทุท ุฃูููุฉ ุงูููุฒุงุช")
st.pyplot(fig)

# ๐ ุชุญููู ูุฎุทุท ุฃูููุฉ ุงูููุฒุงุช
st.markdown("""
๐ **ุชุญููู ูุฎุทุท ุฃูููุฉ ุงูููุฒุงุช:**  
ููุธูุฑ ุงููุฎุทุท ุฃุนูุงู ุงูููุฒุงุช ุงูุฃูุซุฑ ุชุฃุซูุฑูุง ูู ูุฌุงุญ ุงูุญููุงุช ุงูุชุณููููุฉ. ูููู ููุงุญุธุฉ ุฃู ุงูููุฒุงููุฉ ููุฏูุฉ ุงูุญููุฉ ุชุนุชุจุฑุงู ูู ุงูุนูุงูู ุงูุฃูุซุฑ ุฃูููุฉุ ุจูููุง ุชูุนุจ ุงูููุงุฉ ุงูุชุณููููุฉ ูุงููุฆุฉ ุงููุณุชูุฏูุฉ ุฏูุฑูุง ุฃูุถูุง ูููู ุจุฏุฑุฌุงุช ุฃูู.  
ูุชูุญ ูุฐุง ุงูุชุญููู ูููุณูููู ุงูุชุฑููุฒ ุนูู ุงูููุฒุงุช ุงูุฃุณุงุณูุฉ ูุชุญููู ุฃุนูู ูุณุจุฉ ูุฌุงุญ.
""")

# ๐ ุฑุณู ุงูุนูุงูุฉ ุจูู ุงูููุฒุงููุฉ ูุงููุฌุงุญ
st.subheader("๐ธ ุชุฃุซูุฑ ุงูููุฒุงููุฉ ุนูู ูุฌุงุญ ุงูุญููุฉ")
fig2, ax2 = plt.subplots()
sns.scatterplot(data=df, x="budget", y="success", hue="market_condition", style="channel", ax=ax2)
ax2.set_title("ุชุฃุซูุฑ ุงูููุฒุงููุฉ ุนูู ุงููุฌุงุญ")
st.pyplot(fig2)

# ๐ ุชุญููู ุงูุนูุงูุฉ ุจูู ุงูููุฒุงููุฉ ูุงููุฌุงุญ
st.markdown("""
๐ **ุชุญููู ุชุฃุซูุฑ ุงูููุฒุงููุฉ ุนูู ุงููุฌุงุญ:**  
ูุธูุฑ ุงููุฎุทุท ุฃู ููุงู ุนูุงูุฉ ุฅูุฌุงุจูุฉ ุจูู ุงูููุฒุงููุฉ ููุฌุงุญ ุงูุญููุฉ ุงูุชุณููููุฉ.  
ูููู ููุงุญุธุฉ ุฃู ุงูุญููุงุช ุฐุงุช ุงูููุฒุงููุงุช ุงูุฃุนูู ุชููู ุฅูู ุชุญููู ูุฌุงุญ ุฃูุจุฑุ ุฎุงุตุฉ ูู ุธู ุธุฑูู ุณูู ุทุจูุนูุฉ.  
ููุง ุชูุนุจ ุญุงูุฉ ุงูุณูู ุฏูุฑูุง ููููุง ูู ุงูุชุฃุซูุฑ ุนูู ุงููุชูุฌุฉุ ุญูุซ ุชููู ุงูุญููุงุช ุฃูุซุฑ ุชุญุฏููุง ุฃุซูุงุก ุงูุฃุฒูุงุช ุงูุงูุชุตุงุฏูุฉ ุฃู ุฌุงุฆุญุฉ ููุฑููุง.
""")

# ๐ ุชุญููู ุงูุนูุงูุฉ ุจูู ุงูููุงุฉ ูุงููุฌุงุญ
st.subheader("๐ก ุชุฃุซูุฑ ุงูููุงุฉ ุงูุชุณููููุฉ ุนูู ูุฌุงุญ ุงูุญููุฉ")
fig3, ax3 = plt.subplots()
sns.countplot(data=df, x="channel", hue="success", palette="cool", ax=ax3)
ax3.set_title("ูุฌุงุญ ุงูุญููุงุช ุญุณุจ ุงูููุงุฉ")
st.pyplot(fig3)

# ๐ ุชุญููู ูุฌุงุญ ุงูุญููุงุช ุญุณุจ ุงูููุงุฉ
st.markdown("""
๐ **ุชุญููู ูุฌุงุญ ุงูุญููุงุช ุญุณุจ ุงูููุงุฉ:**  
ููุถุญ ุงููุฎุทุท ุชุจุงูู ูุฌุงุญ ุงูุญููุงุช ุจูุงุกู ุนูู ุงูููุงุฉ ุงูุชุณููููุฉ ุงููุณุชุฎุฏูุฉ.  
ูุจุฏู ุฃู ุงููููุงุช ุงูุฑูููุฉ ููุณุงุฆู ุงูุชูุงุตู ุงูุงุฌุชูุงุนู ุชุญูู ูุณุจุฉ ูุฌุงุญ ุฃุนูู ููุงุฑูุฉู ุจุงููููุงุช ุงูุชูููุฏูุฉ ูุซู ุงูุฑุงุฏูู ุฃู ุงูุชููุฒููู.  
ูููู ูููุณูููู ุงุณุชุฎุฏุงู ูุฐู ุงููุนูููุงุช ูุชูุฌูู ุงุณุชุฑุงุชูุฌูุงุชูู ุงูุชุณููููุฉ ูุญู ุงููููุงุช ุงูุฃูุซุฑ ูุงุนููุฉ.  
""")


